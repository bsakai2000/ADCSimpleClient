<meta charset="utf-8">
<html>
	<head>
		<script>
			//Server we're making requests to
			//var server = "http://192.168.56.107/api/";
			var server = "https://rpiadc.com/api/";

			//Make a POST request to the server
			function postRequest(requestURI, ev)
			{
				if(ev !== undefined &&ev.keyCode != 13)
				{
					return;
				}
				var request = new XMLHttpRequest();
				request.onload = function ()
				{
					//Populate the third table with information about the request
					document.getElementById('responseCode').innerHTML = request.status;
					document.getElementById('response').value = request.responseText;
					//If we made a request to admin/login or login, store the JWT we got back
					if(requestURI.indexOf("login") != -1)
					{
						document.getElementById('authentication').value = JSON.parse(request.responseText).SESSIONID;
						decodeToken();
					}
				}
				//Generate the request
				request.open("POST", server + requestURI, false);
				request.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
				//Set an Authorization header containing the JWT in the Authorization Token portion of the last table
				request.setRequestHeader("Authorization", "Bearer " + document.getElementById('authentication').value);
				//Send all the values of the user input fields as a JSON object
				var postData = {};
				postData.RCSid = document.getElementById('RCSid').value;
				postData.username = document.getElementById('username').value;
				postData.password = document.getElementById('password').value;
				postData.newPassword = document.getElementById('newPassword').value;
				postData.door = document.getElementById('door').value;
				postData.Location = document.getElementById('Location').value;
				postData.Message = document.getElementById('Message').value;
				request.send(JSON.stringify(postData));
			}

			//Make a GET request to the server
			function getRequest(requestURI, ev)
			{
				if(ev !== undefined &&ev.keyCode != 13)
				{
					return;
				}
				var request = new XMLHttpRequest();
				request.onload = function ()
				{
					//Populate the third table with information about the request
					document.getElementById('responseCode').innerHTML= request.status;
					document.getElementById('response').value = request.responseText;
					//If we made a request to renew-token, store the JWT we got back
					if(requestURI == 'renew-token')
					{
						document.getElementById('authentication').value = JSON.parse(request.responseText).SESSIONID;
						decodeToken();
					}
				}
				//Generate the request
				request.open("GET", server + requestURI, false);
				//Set an Authorization header containing the JWT in the Authorization Token portion of the last table
				request.setRequestHeader("Authorization", "Bearer " + document.getElementById('authentication').value);
				request.send();
			}

			function decodeToken()
			{
				let token = document.getElementById('authentication').value;
				if(token == "")
					return;
				token = token.split('.');
				let tokenDecoded = atob(token[0]) + " " + atob(token[1]);
				document.getElementById("decodedToken").innerHTML = tokenDecoded;
			}
		</script>
		<style>
			textarea
			{
				width: 100%;
				height: 200px;
			}
			td.apiCall
			{
				cursor: pointer;
			}
		</style>
	</head>
	<body>
		<h4>Simple ADC Client</h4>
		Almost the simplest ADC client possible<br>
		For POST requests, fill the Fields in the first table with the Values you want to send, then click the name of the desired POST request in the second table<br>
		For GET requests, simply click the name of the desired GET request in the second table<br>
		The HTTP Status Code and Server Response for your request will appear in the third table<br>
		If the request returns a SESSIONID, the SESSIONID returned by the server will appear in the third table<br>
		All requests have the Authorization header set using the Authentication Token field from the third table<br><br>
		<!-- This table stores the Fields we can send to the API, with inputs for users to fill in their own values -->
		<table border='1'>
			<tr>
				<td><b>Field</b></td>
				<td><b>Value</b></td>
				<tr>
					<td><label for="RCSid">RCSid</label></td>
					<td><input id="RCSid" placeholder="RCSid"/></td>
				</tr>
				<tr>
					<td><label for="username">username</label></td>
					<td><input id="username" placeholder="username"/></td>
				</tr>
				<tr>
					<td><label for="password">password</label></td>
					<td><input id="password" placeholder="password"/></td>
				</tr>
				<tr>
					<td><label for="newPassword">newPassword</label></td>
					<td><input id="newPassword" placeholder="newPassword"/></td>
				</tr>
				<tr>
					<td><label for="door">door</label></td>
					<td><input id="door" placeholder="door"/></td>
				</tr>
				<tr>
					<td>Location</td>
					<td><input id="Location" placeholder="Location"/></td>
				</tr>
				<tr>
					<td><label for="Message">Message</label></td>
					<td><input id="Message" placeholder="Message"/></td>
				</tr>
		</table><br>
		<!-- This table stores clickable cells that make the requests, sorted by column depending on the type of request (GET or POST) -->
		<table border='1'>
			<tr>
				<td><b>GET Requests</b></td>
				<td><b>POST Requests</b></td>
			</tr>
			<tr>
				<td onkeypress="getRequest('active_user', event)" onclick="getRequest('active_user')" class="apiCall" tabindex=0>active_user</td>
				<td onkeypress="postRequest('login', event)" onclick="postRequest('login')" class="apiCall" tabindex=3>login</td>
			</tr>
			<tr>
				<td onclick="getRequest('inactive_user')" class="apiCall" tabindex=0>inactive_user</td>
				<td onkeypress="postRequest('admin/login', event)" onclick="postRequest('admin/login')" class="apiCall" tabindex=0>admin/login</td>
			</tr>
			<tr>
				<td onkeypress="getRequest('addAll', event)" onclick="getRequest('addAll')" class="apiCall" tabindex=0>addAll</td>
				<td onkeypress="postRequest('request-access', event)" onclick="postRequest('request-access')" class="apiCall" tabindex=0>request-access</td>
			</tr>
			<tr>
				<td onkeypress="getRequest('get-complaints', event)" onclick="getRequest('get-complaints')" class="apiCall" tabindex=0>get-complaints</td>
				<td onkeypress="postRequest('addtoActive', event)" onclick="postRequest('addtoActive')" class="apiCall" tabindex=0>addtoActive</td>
			</tr>
			<tr>
				<td onkeypress="getRequest('get-doors', event)" onclick="getRequest('get-doors')" class="apiCall" tabindex=0>get-doors</td>
				<td onkeypress="postRequest('remove', event)" onclick="postRequest('remove')" class="apiCall" tabindex=0>remove</td>
			</tr>
			<tr>
				<td onkeypress="getRequest('renew-token', event)" onclick="getRequest('renew-token')" class="apiCall" tabindex=0>renew-token</td>
				<td onkeypress="postRequest('submit-complaint', event)" onclick="postRequest('submit-complaint')" class="apiCall" tabindex=0>submit-complaint</td>
			</tr>
			<tr>
				<td></td>
				<td onkeypress="postRequest('open-door', event)" onclick="postRequest('open-door')" class="apiCall" tabindex=-1>open-door</td>
			</tr>
			<tr>
				<td></td>
				<td onkeypress="postRequest('change-password', event)" onclick="postRequest('change-password')" class="apiCall" tabindex=0>change-password</td>
			</tr>
			<tr>
				<td></td>
				<td onkeypress="postRequest('admin/change-password', event)" onclick="postRequest('admin/change-password')" class="apiCall" tabindex=0>admin/change-password</td>
			</tr>
			<tr>
				<td></td>
				<td onkeypress="postRequest('reset-password', event)" onclick="postRequest('reset-password')" class="apiCall" tabindex=0>reset-password</td>
			</tr>
		</table><br>
		<!-- This table stores information about the request, as well as the JWT authentication token currently in use -->
		<table border='1' style="width:100%">
			<tr>
				<td style="width:10%"><b>HTTP Status Code</b></td>
				<td><b>Server Response</b></td>
				<td><b><label for="authentication">Authentication Token</label></b></td>
			</tr>
			<tr>
				<td id="responseCode"></td>
				<td><textarea id="response"></textarea></td>
				<td><textarea id="authentication"></textarea></td>
			</tr>
		</table>
		Decoded token: <span id="decodedToken"></span>
	</body>
</html>
